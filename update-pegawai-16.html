<!DOCTYPE html>
<html>
<head>
    <title>Update Pegawai 16 Izin Cuti</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .result { margin-top: 20px; padding: 10px; background: #f8f9fa; border: 1px solid #ddd; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Update Pegawai 16 Izin Cuti</h1>
        
        <div>
            <h3>1. Check Current Data</h3>
            <button onclick="checkPegawai16()">Check Pegawai 16</button>
            <div id="pegawaiResult" class="result" style="display:none;"></div>
        </div>

        <div>
            <h3>2. Update Izin Cuti</h3>
            <button onclick="updateIzinCuti()">Set Izin Cuti = 12</button>
            <div id="updateResult" class="result" style="display:none;"></div>
        </div>

        <div>
            <h3>3. Test Cuti After Update</h3>
            <button onclick="testCutiAfterUpdate()">Test Cuti Pegawai 16</button>
            <div id="testResult" class="result" style="display:none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';

        async function checkPegawai16() {
            try {
                const response = await fetch(`${API_BASE}/api/pegawai/16`);
                const data = await response.json();
                
                const resultDiv = document.getElementById('pegawaiResult');
                resultDiv.style.display = 'block';
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `<h4>Pegawai 16 Data:</h4><pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h4>Error!</h4><p>${data.message || 'Unknown error'}</p>`;
                }
            } catch (error) {
                const resultDiv = document.getElementById('pegawaiResult');
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h4>Error!</h4><p>${error.message}</p>`;
            }
        }

        async function updateIzinCuti() {
            try {
                // First get current data
                const getResponse = await fetch(`${API_BASE}/api/pegawai/16`);
                const currentData = await getResponse.json();
                
                // Update with izinCuti = 12
                const updateData = {
                    ...currentData,
                    izinCuti: 12
                };

                const response = await fetch(`${API_BASE}/api/pegawai/16`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });

                const resultDiv = document.getElementById('updateResult');
                resultDiv.style.display = 'block';

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `<h4>Update Success!</h4><pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    const errorText = await response.text();
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h4>Update Error!</h4><p>${errorText}</p>`;
                }
            } catch (error) {
                const resultDiv = document.getElementById('updateResult');
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h4>Error!</h4><p>${error.message}</p>`;
            }
        }

        async function testCutiAfterUpdate() {
            try {
                const formData = new FormData();
                formData.append('pegawaiId', '16');
                formData.append('tanggalDari', '2025-07-28');
                formData.append('tanggalKe', '2025-07-28'); // Only 1 day first
                formData.append('jenisCuti', '1'); // Use ID 1 first
                formData.append('alasanCuti', 'Test cuti setelah update');

                const response = await fetch(`${API_BASE}/api/cuti/ajukan`, {
                    method: 'POST',
                    body: formData
                });

                const resultDiv = document.getElementById('testResult');
                resultDiv.style.display = 'block';

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `<h4>Cuti Test Success!</h4><pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    const errorText = await response.text();
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `<h4>Cuti Test Error!</h4><p>${errorText}</p>`;
                }
            } catch (error) {
                const resultDiv = document.getElementById('testResult');
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<h4>Error!</h4><p>${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
